<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voxitema | Vanilla Texture Analyzer</title>

    <!-- --- WEBSITE TAB ICON (FAVICON) --- -->
    <link rel="icon" type="image/png" href="voxitema_logo.png">
    <!-- For mobile devices -->
    <link rel="apple-touch-icon" href="icon.png">

    <!-- Authentic Minecraft Font -->
    <link href="https://fonts.cdnfonts.com/css/minecraft-4" rel="stylesheet">
    
    <style>
        :root {
            --mc-bg: #000;
            --mc-gui: #c6c6c6;
            --mc-border-light: #fff;
            --mc-border-dark: #555;
            --mc-gold: #ffaa00;
            --mc-green: #55ff55;
        }

        * { box-sizing: border-box; image-rendering: pixelated; }

        body {
            background-color: var(--mc-bg);
            font-family: 'Minecraft', sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            color: #fff;
        }

        /* --- Header with Icon --- */
        header { 
            text-align: center; 
            margin-bottom: 25px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .header-icon {
            width: 64px;
            height: 64px;
            image-rendering: pixelated; 
        }

        h1 { font-size: 3.2rem; color: var(--mc-gold); text-shadow: 4px 4px 0 #333; margin: 0; }

        /* --- Upload Container --- */
        .upload-container {
            width: 100%; max-width: 600px; background: #707070;
            border: 4px solid #000; box-shadow: inset -4px -4px 0 #373737, inset 4px 4px 0 #ababab;
            padding: 25px; text-align: center; position: relative; cursor: pointer; margin-bottom: 20px;
        }
        .upload-container:hover { background: #8b8b8b; }
        #fileInput { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        /* --- Search Bar --- */
        .search-container { width: 100%; max-width: 600px; margin-bottom: 40px; }
        #searchInput {
            width: 100%; background: #000; border: 2px solid #a0a0a0; color: #fff;
            font-family: 'Minecraft', sans-serif; padding: 12px; font-size: 1rem; outline: none;
            box-shadow: inset 2px 2px 0 #333;
        }
        #searchInput:focus { border-color: #fff; }

        /* --- Grid & Cards --- */
        #resultsGrid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px; width: 100%; max-width: 1600px;
        }

        .card {
            background: var(--mc-gui);
            border: 3px solid #000;
            box-shadow: inset -3px -3px 0 var(--mc-border-dark), inset 3px 3px 0 var(--mc-border-light);
            padding: 15px; display: flex; flex-direction: column; gap: 10px;
        }

        .hidden { display: none !important; }

        .card-header {
            display: flex; align-items: center; gap: 15px;
            padding-bottom: 8px; border-bottom: 2px solid #9e9e9e;
        }

        .img-frame {
            background: #8b8b8b; border: 2px solid #373737; padding: 4px;
            box-shadow: inset 2px 2px 0 #000; width: 56px; height: 56px;
        }
        .img-frame img { width: 100%; height: 100%; }

        .item-name { font-size: 0.95rem; color: #000; text-transform: uppercase; font-weight: bold; }

        .color-entry { margin-top: 4px; }
        .label-text { font-size: 0.55rem; color: #666; font-weight: bold; text-transform: uppercase; margin-bottom: 2px; }

        .hex-box {
            background: #000; border: 1px solid #373737; position: relative; cursor: pointer;
            height: 45px; display: flex; justify-content: center; align-items: center;
        }

        .hex-value { color: var(--mc-gold); font-size: 1.3rem; }
        .color-bar { position: absolute; bottom: 0; left: 0; width: 100%; height: 5px; border-top: 1px solid #222; }

        #toast {
            position: fixed; bottom: 20px; background: #000; color: var(--mc-green);
            border: 2px solid var(--mc-green); padding: 10px 20px; display: none; z-index: 100;
        }
    </style>
</head>
<body>

    <header>
        <div class="title-container">
            <!-- HEADER ICON -->
            <img src="voxitema_logo.png" class="header-icon" alt="Icon">
            <h1>VOXITEMA</h1>
        </div>
        <div style="color: #777; font-size: 0.75rem; letter-spacing: 1px;">SEMANTIC ANALYSIS SYSTEM</div>
    </header>

    <div class="upload-container">
        <p>IMPORT VANILLA ASSETS</p>
        <input type="file" id="fileInput" multiple accept="image/*">
    </div>

    <div class="search-container">
        <div style="font-size: 0.6rem; color: #aaa; margin-bottom: 5px; text-transform: uppercase;">Find Specific Texture:</div>
        <input type="text" id="searchInput" placeholder="Search analyzed blocks...">
    </div>

    <div id="resultsGrid"></div>
    <div id="toast">COPIED!</div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const searchInput = document.getElementById('searchInput');
        const resultsGrid = document.getElementById('resultsGrid');

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toUpperCase();
            document.querySelectorAll('.card').forEach(card => {
                card.classList.toggle('hidden', !card.getAttribute('data-name').includes(query));
            });
        });

        fileInput.addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            for (const file of files) {
                const name = file.name.split('.').slice(0, -1).join('.').replace(/_/g, ' ').toUpperCase();
                await processFile(file, name);
            }
        });

        async function processFile(file, name) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const palette = analyzeAsset(img, name);
                        renderCard(name, e.target.result, palette);
                        resolve();
                    };
                };
            });
        }

        function analyzeAsset(img, name) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const s = 32;
            canvas.width = s; canvas.height = s;
            ctx.drawImage(img, 0, 0, s, s);
            const data = ctx.getImageData(0, 0, s, s).data;

            const isOrganic = ["FLOWER", "SAPLING", "LEAVES", "GLASS", "WOOL", "SHULKER", "CROP", "GRASS"].some(k => name.includes(k));
            if (isOrganic) return [getAverage(data)];

            let colorCounts = {};
            let redDot = null;

            for (let i = 0; i < data.length; i += 4) {
                const [r, g, b, a] = [data[i], data[i+1], data[i+2], data[i+3]];
                if (a < 128) continue;
                if (r > 155 && g < 75 && b < 75) redDot = rgbToHex(r, g, b);
                const key = `${Math.round(r/12)*12},${Math.round(g/12)*12},${Math.round(b/12)*12}`;
                colorCounts[rgbToHex(r, g, b)] = (colorCounts[rgbToHex(r, g, b)] || 0) + 1;
            }

            const sorted = Object.entries(colorCounts).sort((a, b) => b[1] - a[1]);
            let results = [];
            
            if (sorted[0]) results.push(sorted[0][0]);

            for (let i = 1; i < sorted.length && results.length < 3; i++) {
                if (!isSimilar(sorted[i][0], results, 55)) results.push(sorted[i][0]);
            }

            if (redDot && !isSimilar(redDot, results, 55)) results.push(redDot);
            return results;
        }

        function getAverage(data) {
            let r=0, g=0, b=0, c=0;
            for (let i=0; i<data.length; i+=4) {
                if (data[i+3] < 50) continue;
                r += data[i]; g += data[i+1]; b += data[i+2]; c++;
            }
            return c ? rgbToHex(Math.round(r/c), Math.round(g/c), Math.round(b/c)) : "#000000";
        }

        function isSimilar(h, arr, threshold) {
            return arr.some(existing => {
                const c1 = hexToRgb(h); const c2 = hexToRgb(existing);
                return (Math.abs(c1.r-c2.r) + Math.abs(c1.g-c2.g) + Math.abs(c1.b-c2.b)) < threshold;
            });
        }

        function rgbToHex(r, g, b) {
            return "#" + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase();
        }

        function hexToRgb(hex) {
            const n = parseInt(hex.slice(1), 16);
            return { r: (n >> 16) & 255, g: (n >> 8) & 255, b: n & 255 };
        }

        function renderCard(name, src, colors) {
            let labels = ["PRIMARY SURFACE", "ACCENT DETAIL", "SECONDARY DETAIL", "SIGNAL COLOR"];
            if (name.includes("BULB")) labels = ["BLOCK TEXTURE COLOR", "BULB LIGHT COLOR", "ACCENT DETAIL", "SIGNAL COLOR"];
            if (name.includes("ORE") || name.includes("DEBRIS")) labels = ["STONE BASE", "ORE OVERLAY", "SECONDARY DETAIL"];
            if (colors.length === 1) labels = ["AVERAGE HEX COLOR"];

            const html = colors.map((hex, i) => `
                <div class="color-entry">
                    <div class="label-text">${labels[i] || "DETAIL"}</div>
                    <div class="hex-box" onclick="copy('${hex}')">
                        <span class="hex-value">${hex}</span>
                        <div class="color-bar" style="background-color: ${hex}"></div>
                    </div>
                </div>
            `).join('');

            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-name', name);
            card.innerHTML = `<div class="card-header"><div class="img-frame"><img src="${src}"></div><div class="item-name">${name}</div></div>${html}`;
            resultsGrid.prepend(card);
        }

        function copy(text) {
            navigator.clipboard.writeText(text);
            const t = document.getElementById('toast');
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 1000);
        }
    </script>
</body>
</html>